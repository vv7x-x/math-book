<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الإعلانات | سبشيال وان</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <a href="/" class="logo-link"><img src="/assets/img/ا.png" alt="Logo" class="logo" /></a>
      <div class="titles">
        <h1 class="app-title">الإعلانات</h1>
        <p class="subtitle">آخر الأخبار والتحديثات</p>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.5rem;align-items:end">
        <select id="q_type" class="filter-select">
          <option value="">الكل</option>
          <option value="general">عام</option>
          <option value="important">مهم</option>
          <option value="exam">امتحان</option>
          <option value="assignment">واجب</option>
        </select>
        <button id="btn_filter" class="btn primary">تصفية</button>
      </div>
    </div>

    <div class="card">
      <h3>القائمة</h3>
      <div id="list" class="list"></div>
    </div>
  </main>

  <script src="/assets/js/app.js"></script>
  <script>
  async function load(){
    const params = new URLSearchParams();
    const t = document.getElementById('q_type').value;
    if(t) params.set('type', t);
    const res = await API.apiFetch('/api/announcements' + (params.toString()? ('?' + params.toString()) : ''));
    const data = await res.json();
    const items = Array.isArray(data) ? data : (data.items||[]);
    const list = document.getElementById('list');
    list.innerHTML = '';
    if(!items.length){ list.innerHTML = '<div class="item">لا توجد إعلانات</div>'; return; }
    items.forEach(n=>{
      const d=document.createElement('div'); d.className='item';
      d.innerHTML = `<strong>${n.title||'إعلان'}</strong> — <span style="color:var(--muted)">${new Date(n.date).toLocaleString('ar-EG')}</span><div>${window.SecurityUtils ? SecurityUtils.sanitizeHTML(n.text) : n.text}</div>`;
      list.appendChild(d);
    });
  }
  document.getElementById('btn_filter').onclick = load;
  load();
  </script>
</body>
</html>
